<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å ‚Äî –¢–û–õ–ö</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        * { font-family: 'Inter', sans-serif; }
        .gradient-text {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: all 0.3s ease;
        }
        .btn-primary:hover {
            transform: scale(1.02);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
        }
        .admin-input:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2);
        }
        .image-upload-zone {
            border: 2px dashed #d1d5db;
            transition: all 0.2s ease;
        }
        .image-upload-zone:hover, .image-upload-zone.dragover {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.05);
        }
        .toast {
            animation: slideIn 0.3s ease, fadeOut 0.3s ease 2.7s;
        }
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }
        .modal-overlay {
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(8px);
        }
        .tab-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .drag-handle {
            cursor: grab;
        }
        .drag-handle:active {
            cursor: grabbing;
        }
        .dragging {
            opacity: 0.5;
            background: #f3f4f6;
            border: 2px dashed #667eea;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <!-- Login Screen -->
    <div id="loginScreen" class="min-h-screen flex items-center justify-center p-4">
        <div class="bg-white rounded-3xl p-8 w-full max-w-md shadow-xl">
            <div class="text-center mb-8">
                <div class="w-16 h-16 rounded-2xl bg-gradient-to-br from-purple-500 to-indigo-600 flex items-center justify-center mx-auto mb-4">
                    <span class="text-white text-3xl">‚ú¶</span>
                </div>
                <h1 class="text-2xl font-bold text-gray-900">–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h1>
                <p class="text-gray-500 mt-2">–¢–û–õ–ö ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º</p>
            </div>
            <form onsubmit="login(event)">
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">–ü–∞—Ä–æ–ª—å</label>
                    <input type="password" id="passwordInput" required 
                           class="admin-input w-full px-4 py-3 border border-gray-200 rounded-xl outline-none text-lg"
                           placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å">
                </div>
                <p id="loginError" class="text-red-500 text-sm mb-4 hidden">–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å</p>
                <button type="submit" class="btn-primary w-full text-white py-4 rounded-xl font-semibold text-lg">
                    –í–æ–π—Ç–∏
                </button>
            </form>
            <p class="text-center text-gray-400 text-sm mt-6">
                <a href="index.html" class="hover:text-purple-600 transition">‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ —Å–∞–π—Ç</a>
            </p>
        </div>
    </div>

    <!-- Admin Panel -->
    <div id="adminPanel" class="hidden">
        <!-- Header -->
        <header class="bg-white border-b border-gray-200 sticky top-0 z-40">
            <div class="max-w-6xl mx-auto px-4 py-4 flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-purple-500 to-indigo-600 flex items-center justify-center">
                        <span class="text-white text-xl">‚ú¶</span>
                    </div>
                    <div>
                        <span class="text-xl font-bold gradient-text">–¢–û–õ–ö</span>
                        <span class="text-gray-400 ml-2">/ –ê–¥–º–∏–Ω</span>
                    </div>
                </div>
                <div class="flex items-center gap-4">
                    <a href="index.html" target="_blank" class="text-gray-500 hover:text-purple-600 transition flex items-center gap-2">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/>
                        </svg>
                        –û—Ç–∫—Ä—ã—Ç—å —Å–∞–π—Ç
                    </a>
                    <button onclick="logout()" class="text-gray-500 hover:text-red-600 transition flex items-center gap-2">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/>
                        </svg>
                        –í—ã–π—Ç–∏
                    </button>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="max-w-6xl mx-auto px-4 py-8">
            <!-- Tabs -->
            <div class="flex gap-2 mb-8 overflow-x-auto pb-2">
                <button onclick="switchTab('events')" class="tab-btn active px-6 py-3 rounded-xl font-medium transition whitespace-nowrap" data-tab="events">
                    üìÖ –ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è
                </button>
                <button onclick="switchTab('gallery')" class="tab-btn bg-white text-gray-600 px-6 py-3 rounded-xl font-medium hover:bg-gray-50 transition whitespace-nowrap" data-tab="gallery">
                    üñº –ì–∞–ª–µ—Ä–µ—è
                </button>
                <button onclick="switchTab('content')" class="tab-btn bg-white text-gray-600 px-6 py-3 rounded-xl font-medium hover:bg-gray-50 transition whitespace-nowrap" data-tab="content">
                    ‚úèÔ∏è –ö–æ–Ω—Ç–µ–Ω—Ç —Å–∞–π—Ç–∞
                </button>
                <button onclick="switchTab('settings')" class="tab-btn bg-white text-gray-600 px-6 py-3 rounded-xl font-medium hover:bg-gray-50 transition whitespace-nowrap" data-tab="settings">
                    ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏
                </button>
            </div>

            <!-- Events Tab -->
            <div id="eventsTab" class="tab-content">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-2xl font-bold text-gray-900">–ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è</h2>
                    <button onclick="openEventEditor()" class="btn-primary text-white px-6 py-3 rounded-xl font-medium flex items-center gap-2">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                        </svg>
                        –î–æ–±–∞–≤–∏—Ç—å
                    </button>
                </div>
                <div id="eventsList" class="space-y-4 relative">
                    <div class="text-center py-8 text-gray-400">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                </div>
                <div id="saveOrderBtn" class="hidden fixed bottom-6 right-6 z-40">
                     <button onclick="saveEventOrder()" class="btn-primary text-white px-6 py-3 rounded-xl font-semibold shadow-lg flex items-center gap-2">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>
                        –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø–æ—Ä—è–¥–æ–∫
                     </button>
                </div>
            </div>

            <!-- Gallery Tab -->
            <div id="galleryTab" class="tab-content hidden">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-2xl font-bold text-gray-900">–ì–∞–ª–µ—Ä–µ—è</h2>
                </div>
                
                <div id="galleryUploadZone" class="image-upload-zone rounded-2xl p-8 text-center cursor-pointer mb-8">
                    <div class="w-16 h-16 bg-purple-100 rounded-2xl flex items-center justify-center mx-auto mb-4">
                        <svg class="w-8 h-8 text-purple-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                        </svg>
                    </div>
                    <p class="text-gray-600 font-medium">–ù–∞–∂–º–∏—Ç–µ –∏–ª–∏ –ø–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏</p>
                    <p class="text-gray-400 text-sm mt-1">PNG, JPG –¥–æ 5MB</p>
                </div>
                <input type="file" id="galleryInput" class="hidden" accept="image/*" multiple onchange="handleGalleryUpload(event)">

                <div id="galleryGrid" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4"></div>
                <div id="emptyGalleryAdmin" class="text-center py-16 hidden">
                    <p class="text-gray-400">–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –ø–æ–∫–∞ –Ω–µ—Ç</p>
                </div>
            </div>

            <!-- Content Tab -->
            <div id="contentTab" class="tab-content hidden">
                <h2 class="text-2xl font-bold text-gray-900 mb-6">–ö–æ–Ω—Ç–µ–Ω—Ç —Å–∞–π—Ç–∞</h2>
                
                <div class="space-y-6">
                    <div class="bg-white rounded-2xl p-6">
                        <h3 class="font-semibold text-gray-900 mb-4">üëÅ –í–∏–¥–∏–º–æ—Å—Ç—å –±–ª–æ–∫–æ–≤</h3>
                        <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
                            <label class="flex items-center gap-3 cursor-pointer">
                                <input type="checkbox" id="showHero" class="w-5 h-5 text-purple-600 rounded focus:ring-purple-500 border-gray-300">
                                <span class="text-gray-700 font-medium">–ì–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω</span>
                            </label>
                            <label class="flex items-center gap-3 cursor-pointer">
                                <input type="checkbox" id="showEvents" class="w-5 h-5 text-purple-600 rounded focus:ring-purple-500 border-gray-300">
                                <span class="text-gray-700 font-medium">–ê—Ñ–∏—à–∞</span>
                            </label>
                            <label class="flex items-center gap-3 cursor-pointer">
                                <input type="checkbox" id="showGallery" class="w-5 h-5 text-purple-600 rounded focus:ring-purple-500 border-gray-300">
                                <span class="text-gray-700 font-medium">–ì–∞–ª–µ—Ä–µ—è</span>
                            </label>
                            <label class="flex items-center gap-3 cursor-pointer">
                                <input type="checkbox" id="showAbout" class="w-5 h-5 text-purple-600 rounded focus:ring-purple-500 border-gray-300">
                                <span class="text-gray-700 font-medium">–û –Ω–∞—Å</span>
                            </label>
                            <label class="flex items-center gap-3 cursor-pointer">
                                <input type="checkbox" id="showStats" class="w-5 h-5 text-purple-600 rounded focus:ring-purple-500 border-gray-300">
                                <span class="text-gray-700 font-medium">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</span>
                            </label>
                            <label class="flex items-center gap-3 cursor-pointer">
                                <input type="checkbox" id="showContact" class="w-5 h-5 text-purple-600 rounded focus:ring-purple-500 border-gray-300">
                                <span class="text-gray-700 font-medium">–ö–æ–Ω—Ç–∞–∫—Ç—ã</span>
                            </label>
                        </div>
                    </div>

                    <div class="bg-white rounded-2xl p-6">
                        <h3 class="font-semibold text-gray-900 mb-4">üè† –ì–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω (–¢–µ–∫—Å—Ç)</h3>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">–ü–æ–¥–∑–∞–≥–æ–ª–æ–≤–æ–∫</label>
                            <textarea id="heroSubtitle" class="admin-input w-full px-4 py-3 border border-gray-200 rounded-xl outline-none resize-none" rows="2"></textarea>
                        </div>
                    </div>

                    <div class="bg-white rounded-2xl p-6">
                        <h3 class="font-semibold text-gray-900 mb-4">‚ÑπÔ∏è –û –Ω–∞—Å</h3>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                            <textarea id="aboutText" class="admin-input w-full px-4 py-3 border border-gray-200 rounded-xl outline-none resize-none" rows="4"></textarea>
                        </div>
                    </div>

                    <div class="bg-white rounded-2xl p-6">
                        <h3 class="font-semibold text-gray-900 mb-4">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">–ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π</label>
                                <input type="text" id="statEvents" class="admin-input w-full px-4 py-3 border border-gray-200 rounded-xl outline-none">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">–£—á–∞—Å—Ç–Ω–∏–∫–æ–≤</label>
                                <input type="text" id="statParticipants" class="admin-input w-full px-4 py-3 border border-gray-200 rounded-xl outline-none">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">–õ–æ–∫–∞—Ü–∏–π</label>
                                <input type="text" id="statLocations" class="admin-input w-full px-4 py-3 border border-gray-200 rounded-xl outline-none">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">–í–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏—è</label>
                                <input type="text" id="statInspiration" class="admin-input w-full px-4 py-3 border border-gray-200 rounded-xl outline-none">
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-2xl p-6">
                        <h3 class="font-semibold text-gray-900 mb-4">üîó –°–æ—Ü—Å–µ—Ç–∏</h3>
                        <div class="grid md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Telegram</label>
                                <input type="text" id="socialTelegram" class="admin-input w-full px-4 py-3 border border-gray-200 rounded-xl outline-none">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">–í–ö–æ–Ω—Ç–∞–∫—Ç–µ</label>
                                <input type="text" id="socialVK" class="admin-input w-full px-4 py-3 border border-gray-200 rounded-xl outline-none">
                            </div>
                        </div>
                    </div>

                    <button onclick="saveContent()" class="btn-primary text-white px-8 py-4 rounded-xl font-semibold">
                        –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
                    </button>
                </div>
            </div>

            <!-- Settings Tab -->
            <div id="settingsTab" class="tab-content hidden">
                <h2 class="text-2xl font-bold text-gray-900 mb-6">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
                
                <div class="bg-white rounded-2xl p-6 mb-6">
                    <h3 class="font-semibold text-gray-900 mb-4">üîê –°–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å</h3>
                    <div class="space-y-4 max-w-md">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">–¢–µ–∫—É—â–∏–π –ø–∞—Ä–æ–ª—å</label>
                            <input type="password" id="currentPassword" class="admin-input w-full px-4 py-3 border border-gray-200 rounded-xl outline-none">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å</label>
                            <input type="password" id="newPassword" class="admin-input w-full px-4 py-3 border border-gray-200 rounded-xl outline-none">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å</label>
                            <input type="password" id="confirmPassword" class="admin-input w-full px-4 py-3 border border-gray-200 rounded-xl outline-none">
                        </div>
                        <button onclick="changePassword()" class="btn-primary text-white px-6 py-3 rounded-xl font-medium">
                            –°–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å
                        </button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Event Editor Modal -->
    <div id="eventEditorModal" class="fixed inset-0 z-50 hidden">
        <div class="modal-overlay absolute inset-0" onclick="closeEventEditor()"></div>
        <div class="absolute inset-4 md:inset-auto md:top-1/2 md:left-1/2 md:-translate-x-1/2 md:-translate-y-1/2 md:w-full md:max-w-2xl bg-white rounded-3xl overflow-hidden max-h-[90vh] overflow-y-auto">
            <div class="p-6 border-b border-gray-100 flex items-center justify-between sticky top-0 bg-white z-10">
                <h2 class="text-xl font-bold text-gray-900" id="eventEditorTitle">–ù–æ–≤–æ–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ</h2>
                <button onclick="closeEventEditor()" class="w-10 h-10 rounded-xl bg-gray-100 flex items-center justify-center text-gray-500 hover:bg-gray-200 transition">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            <div class="p-6">
                <form id="eventForm" class="space-y-5">
                    <input type="hidden" id="eventId">
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</label>
                        <div id="imageUploadZone" class="image-upload-zone rounded-2xl p-6 text-center cursor-pointer" onclick="document.getElementById('imageInput').click()">
                            <div id="imagePreview" class="hidden mb-4">
                                <img id="previewImg" class="max-h-32 mx-auto rounded-xl" alt="Preview">
                                <button type="button" onclick="clearEventImage(event)" class="mt-2 text-red-500 text-sm hover:text-red-700">–£–¥–∞–ª–∏—Ç—å</button>
                            </div>
                            <div id="uploadPlaceholder">
                                <div class="w-12 h-12 bg-purple-100 rounded-xl flex items-center justify-center mx-auto mb-3">
                                    <svg class="w-6 h-6 text-purple-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                                    </svg>
                                </div>
                                <p class="text-gray-500 text-sm">–ù–∞–∂–º–∏—Ç–µ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏</p>
                            </div>
                        </div>
                        <input type="file" id="imageInput" class="hidden" accept="image/*" onchange="handleImageUpload(event)">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">–ò–ª–∏ —ç–º–æ–¥–∑–∏</label>
                        <div class="flex gap-2 flex-wrap">
                            <button type="button" onclick="selectEmoji('üé§')" class="emoji-btn w-11 h-11 text-xl bg-gray-100 rounded-xl hover:bg-purple-100 transition">üé§</button>
                            <button type="button" onclick="selectEmoji('ü§ù')" class="emoji-btn w-11 h-11 text-xl bg-gray-100 rounded-xl hover:bg-purple-100 transition">ü§ù</button>
                            <button type="button" onclick="selectEmoji('‚úçÔ∏è')" class="emoji-btn w-11 h-11 text-xl bg-gray-100 rounded-xl hover:bg-purple-100 transition">‚úçÔ∏è</button>
                            <button type="button" onclick="selectEmoji('üé≠')" class="emoji-btn w-11 h-11 text-xl bg-gray-100 rounded-xl hover:bg-purple-100 transition">üé≠</button>
                            <button type="button" onclick="selectEmoji('üìù')" class="emoji-btn w-11 h-11 text-xl bg-gray-100 rounded-xl hover:bg-purple-100 transition">üìù</button>
                        </div>
                        <input type="hidden" id="eventEmoji" value="üé§">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">–ù–∞–∑–≤–∞–Ω–∏–µ *</label>
                        <input type="text" id="eventTitle" required class="admin-input w-full px-4 py-3 border border-gray-200 rounded-xl outline-none">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                        <div class="flex gap-1 mb-2 bg-gray-50 p-1 rounded-lg border border-gray-200 w-fit">
                            <button type="button" onclick="formatText('bold')" class="p-1.5 hover:bg-white rounded text-gray-600 hover:text-purple-600 transition" title="–ñ–∏—Ä–Ω—ã–π (Ctrl+B)"><b>B</b></button>
                            <button type="button" onclick="formatText('italic')" class="p-1.5 hover:bg-white rounded text-gray-600 hover:text-purple-600 transition italic" title="–ö—É—Ä—Å–∏–≤ (Ctrl+I)">I</button>
                            <button type="button" onclick="formatText('underline')" class="p-1.5 hover:bg-white rounded text-gray-600 hover:text-purple-600 transition underline" title="–ü–æ–¥—á—ë—Ä–∫–Ω—É—Ç—ã–π (Ctrl+U)">U</button>
                            <div class="w-px bg-gray-300 mx-1"></div>
                            <button type="button" onclick="formatText('link')" class="p-1.5 hover:bg-white rounded text-gray-600 hover:text-purple-600 transition" title="–°—Å—ã–ª–∫–∞">üîó</button>
                            <button type="button" onclick="formatText('list')" class="p-1.5 hover:bg-white rounded text-gray-600 hover:text-purple-600 transition" title="–°–ø–∏—Å–æ–∫">‚Ä¢</button>
                        </div>
                        <textarea id="eventDescription" class="admin-input w-full px-4 py-3 border border-gray-200 rounded-xl outline-none resize-none font-mono text-sm" rows="6"></textarea>
                        <div class="text-xs text-gray-400 mt-1">–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ: **–∂–∏—Ä–Ω—ã–π**, *–∫—É—Ä—Å–∏–≤*, __–ø–æ–¥—á—ë—Ä–∫–Ω—É—Ç—ã–π__, [—Å—Å—ã–ª–∫–∞](url)</div>
                    </div>

                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">–î–∞—Ç–∞ *</label>
                            <input type="text" id="eventDate" required class="admin-input w-full px-4 py-3 border border-gray-200 rounded-xl outline-none" placeholder="15 —Ñ–µ–≤—Ä–∞–ª—è">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">–í—Ä–µ–º—è *</label>
                            <input type="text" id="eventTime" required class="admin-input w-full px-4 py-3 border border-gray-200 rounded-xl outline-none" placeholder="19:00">
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
                        <select id="eventCategory" class="admin-input w-full px-4 py-3 border border-gray-200 rounded-xl outline-none bg-white">
                            <option value="poetry">–ü–æ—ç–∑–∏—è</option>
                            <option value="networking">–ù–µ—Ç–≤–æ—Ä–∫–∏–Ω–≥</option>
                            <option value="workshop">–ú–∞—Å—Ç–µ—Ä-–∫–ª–∞—Å—Å</option>
                        </select>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">–ú–µ—Å—Ç–æ *</label>
                        <input type="text" id="eventLocation" required class="admin-input w-full px-4 py-3 border border-gray-200 rounded-xl outline-none">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">–ê–¥—Ä–µ—Å *</label>
                        <input type="text" id="eventAddress" required class="admin-input w-full px-4 py-3 border border-gray-200 rounded-xl outline-none">
                    </div>

                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">–¶–µ–Ω–∞ *</label>
                            <input type="text" id="eventPrice" required class="admin-input w-full px-4 py-3 border border-gray-200 rounded-xl outline-none" placeholder="500 ‚ÇΩ">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ</label>
                            <input type="text" id="eventPriceNote" class="admin-input w-full px-4 py-3 border border-gray-200 rounded-xl outline-none" placeholder="–≤–∫–ª—é—á–∞–µ—Ç –Ω–∞–ø–∏—Ç–∫–∏">
                        </div>
                    </div>

                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">–í—Å–µ–≥–æ –º–µ—Å—Ç</label>
                            <input type="number" id="eventSpots" class="admin-input w-full px-4 py-3 border border-gray-200 rounded-xl outline-none" value="30">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">–û—Å—Ç–∞–ª–æ—Å—å –º–µ—Å—Ç</label>
                            <input type="number" id="eventSpotsLeft" class="admin-input w-full px-4 py-3 border border-gray-200 rounded-xl outline-none" value="30">
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">–°—Å—ã–ª–∫–∞ –¥–ª—è –∑–∞–ø–∏—Å–∏</label>
                        <input type="text" id="eventRegistrationLink" class="admin-input w-full px-4 py-3 border border-gray-200 rounded-xl outline-none" placeholder="https://t.me/...">
                    </div>

                    <div class="flex gap-3 pt-4">
                        <button type="button" onclick="closeEventEditor()" class="flex-1 py-4 rounded-xl font-semibold border border-gray-200 text-gray-700 hover:bg-gray-50 transition">
                            –û—Ç–º–µ–Ω–∞
                        </button>
                        <button type="submit" class="flex-1 btn-primary text-white py-4 rounded-xl font-semibold">
                            –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Participants Modal -->
    <div id="participantsModal" class="fixed inset-0 z-50 hidden">
        <div class="modal-overlay absolute inset-0" onclick="closeParticipants()"></div>
        <div class="absolute inset-4 md:inset-auto md:top-1/2 md:left-1/2 md:-translate-x-1/2 md:-translate-y-1/2 md:w-full md:max-w-lg bg-white rounded-3xl overflow-hidden max-h-[90vh] overflow-y-auto">
            <div class="p-6 border-b border-gray-100 flex items-center justify-between sticky top-0 bg-white z-10">
                <div>
                    <h2 class="text-xl font-bold text-gray-900">–ó–∞–ø–∏—Å–∞–≤—à–∏–µ—Å—è</h2>
                    <p class="text-sm text-gray-500" id="participantsEventTitle"></p>
                </div>
                <button onclick="closeParticipants()" class="w-10 h-10 rounded-xl bg-gray-100 flex items-center justify-center text-gray-500 hover:bg-gray-200 transition">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            <div class="p-6">
                <div class="mb-6">
                    <h3 class="font-medium text-gray-700 mb-3" id="participantFormTitle">–î–æ–±–∞–≤–∏—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–∞</h3>
                    <input type="hidden" id="editParticipantId" value="">
                    <div class="space-y-2">
                        <input type="text" id="newParticipantName" class="admin-input w-full px-4 py-2.5 border border-gray-200 rounded-xl outline-none text-sm" placeholder="–ò–º—è *">
                        <input type="text" id="newParticipantContact" class="admin-input w-full px-4 py-2.5 border border-gray-200 rounded-xl outline-none text-sm" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω –∏–ª–∏ @telegram">
                        <div class="grid grid-cols-2 gap-2">
                            <input type="text" id="newParticipantTicketPrice" class="admin-input w-full px-4 py-2.5 border border-gray-200 rounded-xl outline-none text-sm" placeholder="–¶–µ–Ω–∞ –±–∏–ª–µ—Ç–∞ (‚ÇΩ)">
                            <select id="newParticipantPaymentStatus" class="admin-input w-full px-4 py-2.5 border border-gray-200 rounded-xl outline-none text-sm bg-white">
                                <option value="paid">–û–ø–ª–∞—á–µ–Ω–æ ‚úì</option>
                                <option value="pending">–û–∂–∏–¥–∞–µ—Ç</option>
                                <option value="free">–ë–µ—Å–ø–ª–∞—Ç–Ω–æ</option>
                            </select>
                        </div>
                        <input type="text" id="newParticipantNote" class="admin-input w-full px-4 py-2.5 border border-gray-200 rounded-xl outline-none text-sm" placeholder="–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ">
                        <div class="flex gap-2">
                            <button onclick="saveParticipant()" class="btn-primary text-white px-6 py-2.5 rounded-xl font-medium text-sm">
                                <span id="participantSaveBtn">–î–æ–±–∞–≤–∏—Ç—å</span>
                            </button>
                            <button onclick="cancelEditParticipant()" id="cancelEditBtn" class="hidden bg-gray-100 text-gray-600 px-4 py-2.5 rounded-xl font-medium text-sm">
                                –û—Ç–º–µ–Ω–∞
                            </button>
                        </div>
                    </div>
                </div>
                
                <div id="participantsSummary" class="mb-4 p-4 bg-green-50 rounded-xl hidden">
                    <div class="flex items-center justify-between text-sm">
                        <span><span class="font-medium text-green-700" id="summaryPaidCount">0</span> –æ–ø–ª–∞—Ç–∏–ª–∏ ‚Ä¢ <span class="font-medium text-yellow-600" id="summaryPendingCount">0</span> –æ–∂–∏–¥–∞—é—Ç</span>
                        <span class="font-semibold text-green-700" id="summaryTotalAmount">0 ‚ÇΩ</span>
                    </div>
                </div>
                
                <div>
                    <div class="flex items-center justify-between mb-3">
                        <h3 class="font-medium text-gray-700">–°–ø–∏—Å–æ–∫</h3>
                        <span class="text-sm text-gray-400" id="participantsCount">0</span>
                    </div>
                    <div id="participantsList" class="space-y-2"></div>
                    <div id="emptyParticipants" class="text-center py-8 hidden">
                        <p class="text-gray-400 text-sm">–ü–æ–∫–∞ –Ω–∏–∫—Ç–æ –Ω–µ –∑–∞–ø–∏—Å–∞–ª—Å—è</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toastContainer" class="fixed top-4 right-4 z-[70] space-y-2"></div>

    <script>
        const API_URL = 'api.php';
        
        let events = [];
        let gallery = [];
        let siteContent = {};
        let currentEventImage = null;
        let currentParticipantsEventId = null;
        
        // Login
        async function login(e) {
            e.preventDefault();
            const password = document.getElementById('passwordInput').value;
            
            try {
                const res = await fetch(`${API_URL}?action=login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ password })
                });
                const data = await res.json();
                
                if (data.success) {
                    sessionStorage.setItem('tolkAdminLoggedIn', 'true');
                    sessionStorage.setItem('tolkAdminPassword', password);
                    showAdminPanel();
                } else {
                    document.getElementById('loginError').classList.remove('hidden');
                }
            } catch (error) {
                showToast('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É', 'error');
            }
        }

        function logout() {
            sessionStorage.removeItem('tolkAdminLoggedIn');
            location.reload();
        }

        function showAdminPanel() {
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('adminPanel').classList.remove('hidden');
            loadData();
        }

        // Load Data
        async function loadData() {
            try {
                const [eventsRes, galleryRes, contentRes] = await Promise.all([
                    fetch(`${API_URL}?action=getEvents&showHidden=true`),
                    fetch(`${API_URL}?action=getGallery`),
                    fetch(`${API_URL}?action=getContent`)
                ]);
                
                events = await eventsRes.json();
                gallery = await galleryRes.json();
                siteContent = await contentRes.json();
                
                renderEventsList();
                renderGalleryAdmin();
                loadContentToForm();
            } catch (error) {
                showToast('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö', 'error');
            }
        }

        // Tabs
        function switchTab(tab) {
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
                btn.classList.add('bg-white', 'text-gray-600');
            });
            document.querySelector(`[data-tab="${tab}"]`).classList.add('active');
            document.querySelector(`[data-tab="${tab}"]`).classList.remove('bg-white', 'text-gray-600');
            
            document.querySelectorAll('.tab-content').forEach(content => content.classList.add('hidden'));
            document.getElementById(`${tab}Tab`).classList.remove('hidden');
        }

        // Events
        function renderEventsList() {
            const list = document.getElementById('eventsList');
            
            if (!Array.isArray(events) || events.length === 0) {
                list.innerHTML = '<div class="text-center py-16 bg-white rounded-2xl"><p class="text-gray-400">–ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π –ø–æ–∫–∞ –Ω–µ—Ç</p></div>';
                return;
            }
            
            list.innerHTML = events.map(event => {
                const isHidden = event.hidden;
                const participantsCount = event.participants ? event.participants.length : 0;
                
                return `
                <div class="bg-white rounded-2xl p-5 ${isHidden ? 'opacity-60' : ''}">
                    <div class="flex items-center gap-4">
                        <div class="w-16 h-16 rounded-xl bg-gray-100 flex items-center justify-center text-3xl overflow-hidden flex-shrink-0">
                            ${event.image ? `<img src="${event.image}" class="w-full h-full object-cover">` : event.emoji || 'üé§'}
                        </div>
                        <div class="flex-1 min-w-0">
                            <div class="flex items-center gap-2">
                                <h4 class="font-semibold text-gray-900 truncate">${event.title}</h4>
                                ${isHidden ? '<span class="text-xs bg-gray-200 text-gray-600 px-2 py-0.5 rounded-full">–°–∫—Ä—ã—Ç–æ</span>' : ''}
                            </div>
                            <p class="text-sm text-gray-500">${event.date}, ${event.time} ‚Ä¢ ${event.location}</p>
                            <p class="text-sm text-purple-600 font-medium">${event.price}</p>
                        </div>
                        <div class="flex gap-2 flex-shrink-0">
                            <div class="drag-handle w-10 h-10 rounded-xl bg-gray-100 flex items-center justify-center text-gray-400 cursor-grab hover:bg-gray-200 transition" title="–ü–µ—Ä–µ—Ç–∞—â–∏—Ç—å –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8h16M4 16h16"/>
                                </svg>
                            </div>
                            <button onclick="copyEventLink(${event.id})" class="w-10 h-10 rounded-xl bg-gray-100 flex items-center justify-center text-gray-500 hover:text-blue-600 hover:bg-blue-50 transition" title="–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"/>
                                </svg>
                            </button>
                            <button onclick="toggleEventVisibility(${event.id})" class="w-10 h-10 rounded-xl ${isHidden ? 'bg-yellow-100 text-yellow-600' : 'bg-gray-100 text-gray-500'} flex items-center justify-center hover:bg-yellow-100 hover:text-yellow-600 transition" title="${isHidden ? '–ü–æ–∫–∞–∑–∞—Ç—å' : '–°–∫—Ä—ã—Ç—å'}">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    ${isHidden ? '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"/>' : '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>'}
                                </svg>
                            </button>
                            <button onclick="openParticipants(${event.id})" class="w-10 h-10 rounded-xl bg-gray-100 flex items-center justify-center text-gray-500 hover:text-green-600 hover:bg-green-50 transition relative" title="–£—á–∞—Å—Ç–Ω–∏–∫–∏">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z"/>
                                </svg>
                                ${participantsCount > 0 ? `<span class="absolute -top-1 -right-1 w-5 h-5 bg-green-500 text-white text-xs rounded-full flex items-center justify-center">${participantsCount}</span>` : ''}
                            </button>
                            <button onclick="editEvent(${event.id})" class="w-10 h-10 rounded-xl bg-gray-100 flex items-center justify-center text-gray-500 hover:text-purple-600 hover:bg-purple-50 transition" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"/>
                                </svg>
                            </button>
                            <button onclick="deleteEvent(${event.id})" class="w-10 h-10 rounded-xl bg-gray-100 flex items-center justify-center text-gray-500 hover:text-red-600 hover:bg-red-50 transition" title="–£–¥–∞–ª–∏—Ç—å">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
            `}).join('');
        }

        function openEventEditor(eventId = null) {
            document.getElementById('eventEditorTitle').textContent = eventId ? '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å' : '–ù–æ–≤–æ–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ';
            document.getElementById('eventForm').reset();
            document.getElementById('eventId').value = eventId || '';
            currentEventImage = null;
            
            document.getElementById('imagePreview').classList.add('hidden');
            document.getElementById('uploadPlaceholder').classList.remove('hidden');
            
            if (eventId) {
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º –Ω–µ—Å—Ç—Ä–æ–≥–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ (== –≤–º–µ—Å—Ç–æ ===), —Ç–∞–∫ –∫–∞–∫ ID –º–æ–∂–µ—Ç –±—ã—Ç—å —Å—Ç—Ä–æ–∫–æ–π –∏–∑ –ë–î
                const event = events.find(e => e.id == eventId);
                if (event) {
                    document.getElementById('eventTitle').value = event.title;
                    document.getElementById('eventDescription').value = event.description || '';
                    document.getElementById('eventDate').value = event.date;
                    document.getElementById('eventTime').value = event.time;
                    document.getElementById('eventCategory').value = event.category;
                    document.getElementById('eventLocation').value = event.location;
                    document.getElementById('eventAddress').value = event.address;
                    document.getElementById('eventPrice').value = event.price;
                    document.getElementById('eventPriceNote').value = event.priceNote || '';
                    document.getElementById('eventSpots').value = event.spots;
                    document.getElementById('eventSpotsLeft').value = event.spotsLeft;
                    document.getElementById('eventEmoji').value = event.emoji || 'üé§';
                    document.getElementById('eventRegistrationLink').value = event.registrationLink || '';
                    
                    if (event.image) {
                        currentEventImage = event.image;
                        document.getElementById('previewImg').src = event.image;
                        document.getElementById('imagePreview').classList.remove('hidden');
                        document.getElementById('uploadPlaceholder').classList.add('hidden');
                    }
                }
            }
            
            document.getElementById('eventEditorModal').classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }

        function closeEventEditor() {
            document.getElementById('eventEditorModal').classList.add('hidden');
            document.body.style.overflow = '';
        }

        function editEvent(eventId) {
            openEventEditor(eventId);
        }

        async function deleteEvent(eventId) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ?')) return;
            
            try {
                await fetch(`${API_URL}?action=deleteEvent`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ id: eventId })
                });
                await loadData();
                showToast('–ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ —É–¥–∞–ª–µ–Ω–æ');
            } catch (error) {
                showToast('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è', 'error');
            }
        }

        async function toggleEventVisibility(eventId) {
            try {
                await fetch(`${API_URL}?action=toggleEventVisibility`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ id: eventId })
                });
                await loadData();
                showToast('–í–∏–¥–∏–º–æ—Å—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∞');
            } catch (error) {
                showToast('–û—à–∏–±–∫–∞', 'error');
            }
        }

        function copyEventLink(eventId) {
            const url = `${window.location.origin}/index.html?event=${eventId}`;
            navigator.clipboard.writeText(url);
            showToast('–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞');
        }

        function selectEmoji(emoji) {
            document.getElementById('eventEmoji').value = emoji;
            document.querySelectorAll('.emoji-btn').forEach(btn => {
                btn.classList.remove('ring-2', 'ring-purple-500', 'bg-purple-100');
                if (btn.textContent === emoji) {
                    btn.classList.add('ring-2', 'ring-purple-500', 'bg-purple-100');
                }
            });
        }

        function handleImageUpload(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            if (file.size > 5 * 1024 * 1024) {
                showToast('–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π', 'error');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(event) {
                const img = new Image();
                img.onload = function() {
                    const canvas = document.createElement('canvas');
                    const maxSize = 800;
                    let width = img.width;
                    let height = img.height;
                    
                    if (width > height && width > maxSize) {
                        height = (height * maxSize) / width;
                        width = maxSize;
                    } else if (height > maxSize) {
                        width = (width * maxSize) / height;
                        height = maxSize;
                    }
                    
                    canvas.width = width;
                    canvas.height = height;
                    canvas.getContext('2d').drawImage(img, 0, 0, width, height);
                    
                    currentEventImage = canvas.toDataURL('image/jpeg', 0.7);
                    document.getElementById('previewImg').src = currentEventImage;
                    document.getElementById('imagePreview').classList.remove('hidden');
                    document.getElementById('uploadPlaceholder').classList.add('hidden');
                };
                img.src = event.target.result;
            };
            reader.readAsDataURL(file);
        }

        function clearEventImage(e) {
            e.stopPropagation();
            currentEventImage = null;
            document.getElementById('previewImg').src = '';
            document.getElementById('imagePreview').classList.add('hidden');
            document.getElementById('uploadPlaceholder').classList.remove('hidden');
        }

        document.getElementById('eventForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const categoryLabels = {
                'poetry': '–ü–æ—ç–∑–∏—è',
                'networking': '–ù–µ—Ç–≤–æ—Ä–∫–∏–Ω–≥',
                'workshop': '–ú–∞—Å—Ç–µ—Ä-–∫–ª–∞—Å—Å'
            };
            
            const eventId = document.getElementById('eventId').value;
            const eventData = {
                id: eventId ? parseInt(eventId) : null,
                title: document.getElementById('eventTitle').value,
                description: document.getElementById('eventDescription').value,
                date: document.getElementById('eventDate').value,
                time: document.getElementById('eventTime').value,
                category: document.getElementById('eventCategory').value,
                categoryLabel: categoryLabels[document.getElementById('eventCategory').value],
                location: document.getElementById('eventLocation').value,
                address: document.getElementById('eventAddress').value,
                price: document.getElementById('eventPrice').value,
                priceNote: document.getElementById('eventPriceNote').value,
                spots: parseInt(document.getElementById('eventSpots').value) || 30,
                spotsLeft: parseInt(document.getElementById('eventSpotsLeft').value) || 30,
                emoji: document.getElementById('eventEmoji').value || 'üé§',
                image: currentEventImage,
                registrationLink: document.getElementById('eventRegistrationLink').value
            };
            
            try {
                await fetch(`${API_URL}?action=saveEvent`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(eventData)
                });
                
                // –ü–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ
                await loadData();
                closeEventEditor();
                showToast(eventId ? '–ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–æ' : '–ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ');
            } catch (error) {
                showToast('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è', 'error');
            }
        });

        // Gallery
        function renderGalleryAdmin() {
            const grid = document.getElementById('galleryGrid');
            const emptyState = document.getElementById('emptyGalleryAdmin');
            
            if (!Array.isArray(gallery) || gallery.length === 0) {
                grid.classList.add('hidden');
                emptyState.classList.remove('hidden');
                return;
            }
            
            grid.classList.remove('hidden');
            emptyState.classList.add('hidden');
            
            grid.innerHTML = gallery.map((img, index) => `
                <div class="relative group aspect-square rounded-xl overflow-hidden">
                    <img src="${img}" alt="–§–æ—Ç–æ ${index + 1}" class="w-full h-full object-cover">
                    <button onclick="deleteGalleryImage('${img.replace(/'/g, "\\'")}')" class="absolute top-2 right-2 w-8 h-8 bg-red-500 text-white rounded-lg opacity-0 group-hover:opacity-100 transition flex items-center justify-center">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                        </svg>
                    </button>
                </div>
            `).join('');
        }

        async function handleGalleryUpload(e) {
            const files = e.target.files;
            
            for (const file of files) {
                if (file.size > 5 * 1024 * 1024) continue;
                
                const reader = new FileReader();
                reader.onload = async function(event) {
                    try {
                        await fetch(`${API_URL}?action=addGalleryImage`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ image: event.target.result })
                        });
                        await loadData();
                    } catch (error) {
                        showToast('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏', 'error');
                    }
                };
                reader.readAsDataURL(file);
            }
            showToast('–§–æ—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω—ã');
        }

        async function deleteGalleryImage(image) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ —Ñ–æ—Ç–æ?')) return;
            
            try {
                await fetch(`${API_URL}?action=deleteGalleryImage`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ image })
                });
                await loadData();
                showToast('–§–æ—Ç–æ —É–¥–∞–ª–µ–Ω–æ');
            } catch (error) {
                showToast('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è', 'error');
            }
        }

        // Gallery upload zone
        const galleryZone = document.getElementById('galleryUploadZone');
        galleryZone.addEventListener('click', () => document.getElementById('galleryInput').click());
        galleryZone.addEventListener('dragover', e => { e.preventDefault(); galleryZone.classList.add('dragover'); });
        galleryZone.addEventListener('dragleave', () => galleryZone.classList.remove('dragover'));
        galleryZone.addEventListener('drop', e => {
            e.preventDefault();
            galleryZone.classList.remove('dragover');
            document.getElementById('galleryInput').files = e.dataTransfer.files;
            handleGalleryUpload({ target: { files: e.dataTransfer.files } });
        });

        // Content
        function loadContentToForm() {
            if (!siteContent) return;
            
            // Text content
            document.getElementById('heroSubtitle').value = siteContent.heroSubtitle || '';
            document.getElementById('aboutText').value = siteContent.aboutText || '';
            document.getElementById('statEvents').value = siteContent.statEvents || '';
            document.getElementById('statParticipants').value = siteContent.statParticipants || '';
            document.getElementById('statLocations').value = siteContent.statLocations || '';
            document.getElementById('statInspiration').value = siteContent.statInspiration || '';
            document.getElementById('socialTelegram').value = siteContent.socialTelegram || '';
            document.getElementById('socialVK').value = siteContent.socialVK || '';

            // Visibility (default to true if undefined)
            const check = (id, key) => {
                const val = siteContent[key];
                document.getElementById(id).checked = (val !== '0' && val !== 'false');
            };
            
            check('showHero', 'showHero');
            check('showEvents', 'showEvents');
            check('showGallery', 'showGallery');
            check('showAbout', 'showAbout');
            check('showStats', 'showStats');
            check('showContact', 'showContact');
        }

        async function saveContent() {
            const content = {
                // Visibility
                showHero: document.getElementById('showHero').checked ? '1' : '0',
                showEvents: document.getElementById('showEvents').checked ? '1' : '0',
                showGallery: document.getElementById('showGallery').checked ? '1' : '0',
                showAbout: document.getElementById('showAbout').checked ? '1' : '0',
                showStats: document.getElementById('showStats').checked ? '1' : '0',
                showContact: document.getElementById('showContact').checked ? '1' : '0',
                
                // Content
                heroSubtitle: document.getElementById('heroSubtitle').value,
                aboutText: document.getElementById('aboutText').value,
                statEvents: document.getElementById('statEvents').value,
                statParticipants: document.getElementById('statParticipants').value,
                statLocations: document.getElementById('statLocations').value,
                statInspiration: document.getElementById('statInspiration').value,
                socialTelegram: document.getElementById('socialTelegram').value,
                socialVK: document.getElementById('socialVK').value
            };
            
            try {
                await fetch(`${API_URL}?action=saveContent`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(content)
                });
                showToast('–ò–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã');
            } catch (error) {
                showToast('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è', 'error');
            }
        }

        // Participants
        function openParticipants(eventId) {
            currentParticipantsEventId = eventId;
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º –Ω–µ—Å—Ç—Ä–æ–≥–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ (==), —á—Ç–æ–±—ã –Ω–∞–π—Ç–∏ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ, –¥–∞–∂–µ –µ—Å–ª–∏ ID –ø—Ä–∏—à–µ–ª –∫–∞–∫ —Å—Ç—Ä–æ–∫–∞
            const event = events.find(e => e.id == eventId);
            if (!event) return;
            
            document.getElementById('participantsEventTitle').textContent = event.title;
            clearParticipantForm();
            renderParticipantsList(event);
            
            document.getElementById('participantsModal').classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }

        function closeParticipants() {
            document.getElementById('participantsModal').classList.add('hidden');
            document.body.style.overflow = '';
        }

        function clearParticipantForm() {
            document.getElementById('newParticipantName').value = '';
            document.getElementById('newParticipantContact').value = '';
            document.getElementById('newParticipantTicketPrice').value = '';
            document.getElementById('newParticipantPaymentStatus').value = 'paid';
            document.getElementById('newParticipantNote').value = '';
            document.getElementById('editParticipantId').value = '';
            document.getElementById('participantFormTitle').textContent = '–î–æ–±–∞–≤–∏—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–∞';
            document.getElementById('participantSaveBtn').textContent = '–î–æ–±–∞–≤–∏—Ç—å';
            document.getElementById('cancelEditBtn').classList.add('hidden');
        }

        function renderParticipantsList(event) {
            const participants = event.participants || [];
            const list = document.getElementById('participantsList');
            const emptyState = document.getElementById('emptyParticipants');
            const summary = document.getElementById('participantsSummary');
            
            document.getElementById('participantsCount').textContent = `${participants.length} —á–µ–ª.`;
            
            let paidCount = 0, pendingCount = 0, totalAmount = 0;
            participants.forEach(p => {
                const price = parseFloat(p.ticketPrice || p.ticket_price) || 0;
                const status = p.paymentStatus || p.payment_status;
                if (status === 'paid') { paidCount++; totalAmount += price; }
                else if (status === 'pending') { pendingCount++; }
                else { paidCount++; }
            });
            
            if (participants.length > 0) {
                summary.classList.remove('hidden');
                document.getElementById('summaryPaidCount').textContent = paidCount;
                document.getElementById('summaryPendingCount').textContent = pendingCount;
                document.getElementById('summaryTotalAmount').textContent = totalAmount.toLocaleString('ru-RU') + ' ‚ÇΩ';
            } else {
                summary.classList.add('hidden');
            }
            
            if (participants.length === 0) {
                list.classList.add('hidden');
                emptyState.classList.remove('hidden');
                return;
            }
            
            list.classList.remove('hidden');
            emptyState.classList.add('hidden');
            
            const statusLabels = {
                'paid': { text: '–û–ø–ª–∞—á–µ–Ω–æ', class: 'bg-green-100 text-green-700' },
                'pending': { text: '–û–∂–∏–¥–∞–µ—Ç', class: 'bg-yellow-100 text-yellow-700' },
                'free': { text: '–ë–µ—Å–ø–ª–∞—Ç–Ω–æ', class: 'bg-blue-100 text-blue-700' }
            };
            
            list.innerHTML = participants.map(p => {
                const status = statusLabels[p.paymentStatus || p.payment_status] || statusLabels['pending'];
                const price = p.ticketPrice || p.ticket_price;
                
                return `
                <div class="flex items-center gap-3 p-3 bg-gray-50 rounded-xl">
                    <div class="w-10 h-10 rounded-full bg-gradient-to-br from-purple-400 to-indigo-500 flex items-center justify-center text-white font-medium text-sm flex-shrink-0">
                        ${p.name.charAt(0).toUpperCase()}
                    </div>
                    <div class="flex-1 min-w-0">
                        <div class="flex items-center gap-2 flex-wrap">
                            <span class="font-medium text-gray-900">${p.name}</span>
                            <span class="text-xs px-2 py-0.5 rounded-full ${status.class}">${status.text}</span>
                            ${price ? `<span class="text-xs text-gray-500">${price} ‚ÇΩ</span>` : ''}
                        </div>
                        <div class="text-sm text-gray-500">${p.contact || '–ù–µ—Ç –∫–æ–Ω—Ç–∞–∫—Ç–∞'}</div>
                        ${p.note ? `<div class="text-xs text-gray-400 mt-0.5">${p.note}</div>` : ''}
                    </div>
                    <div class="flex gap-1 flex-shrink-0">
                        <button onclick="editParticipant(${p.id})" class="w-8 h-8 rounded-lg bg-white border border-gray-200 flex items-center justify-center text-gray-400 hover:text-purple-500 transition">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"/>
                            </svg>
                        </button>
                        <button onclick="removeParticipant(${p.id})" class="w-8 h-8 rounded-lg bg-white border border-gray-200 flex items-center justify-center text-gray-400 hover:text-red-500 transition">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                            </svg>
                        </button>
                    </div>
                </div>
            `}).join('');
        }

        function editParticipant(participantId) {
            const event = events.find(e => e.id === currentParticipantsEventId);
            if (!event || !event.participants) return;
            
            const p = event.participants.find(p => p.id === participantId);
            if (!p) return;
            
            document.getElementById('newParticipantName').value = p.name || '';
            document.getElementById('newParticipantContact').value = p.contact || '';
            document.getElementById('newParticipantTicketPrice').value = p.ticketPrice || p.ticket_price || '';
            document.getElementById('newParticipantPaymentStatus').value = p.paymentStatus || p.payment_status || 'paid';
            document.getElementById('newParticipantNote').value = p.note || '';
            document.getElementById('editParticipantId').value = participantId;
            
            document.getElementById('participantFormTitle').textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å';
            document.getElementById('participantSaveBtn').textContent = '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å';
            document.getElementById('cancelEditBtn').classList.remove('hidden');
        }

        function cancelEditParticipant() {
            clearParticipantForm();
        }

        async function saveParticipant() {
            const name = document.getElementById('newParticipantName').value.trim();
            if (!name) {
                showToast('–í–≤–µ–¥–∏—Ç–µ –∏–º—è', 'error');
                return;
            }
            
            const editId = document.getElementById('editParticipantId').value;
            const data = {
                id: editId ? parseInt(editId) : null,
                eventId: currentParticipantsEventId,
                name,
                contact: document.getElementById('newParticipantContact').value.trim(),
                ticketPrice: document.getElementById('newParticipantTicketPrice').value.trim(),
                paymentStatus: document.getElementById('newParticipantPaymentStatus').value,
                note: document.getElementById('newParticipantNote').value.trim()
            };
            
            try {
                await fetch(`${API_URL}?action=saveParticipant`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                
                await loadData();
                const event = events.find(e => e.id === currentParticipantsEventId);
                if (event) renderParticipantsList(event);
                clearParticipantForm();
                showToast(editId ? '–£—á–∞—Å—Ç–Ω–∏–∫ –æ–±–Ω–æ–≤–ª—ë–Ω' : '–£—á–∞—Å—Ç–Ω–∏–∫ –¥–æ–±–∞–≤–ª–µ–Ω');
            } catch (error) {
                showToast('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è', 'error');
            }
        }

        async function removeParticipant(participantId) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–∞?')) return;
            
            try {
                await fetch(`${API_URL}?action=deleteParticipant`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ id: participantId })
                });
                
                await loadData();
                const event = events.find(e => e.id === currentParticipantsEventId);
                if (event) renderParticipantsList(event);
                showToast('–£—á–∞—Å—Ç–Ω–∏–∫ —É–¥–∞–ª—ë–Ω');
            } catch (error) {
                showToast('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è', 'error');
            }
        }

        // Password
        async function changePassword() {
            const current = document.getElementById('currentPassword').value;
            const newPass = document.getElementById('newPassword').value;
            const confirm = document.getElementById('confirmPassword').value;
            
            if (newPass.length < 4) {
                showToast('–ü–∞—Ä–æ–ª—å —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–π', 'error');
                return;
            }
            if (newPass !== confirm) {
                showToast('–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç', 'error');
                return;
            }
            
            try {
                const res = await fetch(`${API_URL}?action=changePassword`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ currentPassword: current, newPassword: newPass })
                });
                const data = await res.json();
                
                if (data.success) {
                    document.getElementById('currentPassword').value = '';
                    document.getElementById('newPassword').value = '';
                    document.getElementById('confirmPassword').value = '';
                    showToast('–ü–∞—Ä–æ–ª—å –∏–∑–º–µ–Ω—ë–Ω');
                } else {
                    showToast(data.error || '–û—à–∏–±–∫–∞', 'error');
                }
            } catch (error) {
                showToast('–û—à–∏–±–∫–∞', 'error');
            }
        }

        // Toast
        function showToast(message, type = 'success') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast bg-white rounded-xl shadow-lg p-4 flex items-center gap-3 border ${type === 'success' ? 'border-green-200' : 'border-red-200'}`;
            toast.innerHTML = `
                <div class="w-8 h-8 rounded-full ${type === 'success' ? 'bg-green-100 text-green-600' : 'bg-red-100 text-red-600'} flex items-center justify-center font-bold">
                    ${type === 'success' ? '‚úì' : '‚úï'}
                </div>
                <span class="text-gray-700 font-medium">${message}</span>
            `;
            container.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }

        // Keyboard
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeEventEditor();
                closeParticipants();
            }
            
            // –ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
            if (e.target.id === 'eventDescription') {
                if (e.ctrlKey || e.metaKey) {
                    if (e.key === 'b') { e.preventDefault(); formatText('bold'); }
                    if (e.key === 'i') { e.preventDefault(); formatText('italic'); }
                    if (e.key === 'u') { e.preventDefault(); formatText('underline'); }
                }
            }
        });

        // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞
        function formatText(type) {
            const textarea = document.getElementById('eventDescription');
            const start = textarea.selectionStart;
            const end = textarea.selectionEnd;
            const text = textarea.value;
            const selectedText = text.substring(start, end);
            
            let before = '', after = '', insert = '';
            
            switch(type) {
                case 'bold':
                    before = '**'; after = '**';
                    break;
                case 'italic':
                    before = '*'; after = '*';
                    break;
                case 'underline':
                    before = '__'; after = '__';
                    break;
                case 'link':
                    const url = prompt('–í–≤–µ–¥–∏—Ç–µ URL:', 'https://');
                    if (url) {
                        before = '['; after = `](${url})`;
                    } else return;
                    break;
                case 'list':
                    insert = '\n‚Ä¢ ';
                    break;
            }
            
            if (insert) {
                textarea.value = text.substring(0, start) + insert + text.substring(end);
                textarea.selectionStart = textarea.selectionEnd = start + insert.length;
            } else {
                const newText = before + (selectedText || '—Ç–µ–∫—Å—Ç') + after;
                textarea.value = text.substring(0, start) + newText + text.substring(end);
                textarea.selectionStart = start + before.length;
                textarea.selectionEnd = start + before.length + (selectedText || '—Ç–µ–∫—Å—Ç').length;
            }
            
            textarea.focus();
        }

        // Drag & Drop —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞
        let draggedItem = null;
        let orderChanged = false;

        function initDragAndDrop() {
            const list = document.getElementById('eventsList');
            const items = list.querySelectorAll('.bg-white.rounded-2xl');
            
            items.forEach((item, index) => {
                item.setAttribute('draggable', 'true');
                item.dataset.index = index;
                
                item.addEventListener('dragstart', (e) => {
                    draggedItem = item;
                    item.classList.add('dragging');
                    e.dataTransfer.effectAllowed = 'move';
                });
                
                item.addEventListener('dragend', () => {
                    item.classList.remove('dragging');
                    draggedItem = null;
                });
                
                item.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    if (draggedItem && draggedItem !== item) {
                        const rect = item.getBoundingClientRect();
                        const midY = rect.top + rect.height / 2;
                        if (e.clientY < midY) {
                            item.parentNode.insertBefore(draggedItem, item);
                        } else {
                            item.parentNode.insertBefore(draggedItem, item.nextSibling);
                        }
                        orderChanged = true;
                        document.getElementById('saveOrderBtn').classList.remove('hidden');
                    }
                });
            });
        }

        async function saveEventOrder() {
            const list = document.getElementById('eventsList');
            const items = list.querySelectorAll('.bg-white.rounded-2xl');
            
            const orders = [];
            items.forEach((item, index) => {
                // –ù–∞—Ö–æ–¥–∏–º ID –∏–∑ onclick –≤ –∫–Ω–æ–ø–∫–∞—Ö
                const editBtn = item.querySelector('button[onclick^="editEvent"]');
                if (editBtn) {
                    const match = editBtn.getAttribute('onclick').match(/editEvent\((\d+)\)/);
                    if (match) {
                        orders.push({ id: parseInt(match[1]), order: index });
                    }
                }
            });
            
            try {
                await fetch(`${API_URL}?action=reorderEvents`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ orders })
                });
                
                orderChanged = false;
                document.getElementById('saveOrderBtn').classList.add('hidden');
                showToast('–ü–æ—Ä—è–¥–æ–∫ —Å–æ—Ö—Ä–∞–Ω—ë–Ω');
                await loadData();
            } catch (error) {
                showToast('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–æ—Ä—è–¥–∫–∞', 'error');
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Drag & Drop –ø–æ—Å–ª–µ —Ä–µ–Ω–¥–µ—Ä–∞ —Å–ø–∏—Å–∫–∞
        const originalRenderEventsList = renderEventsList;
        renderEventsList = function() {
            originalRenderEventsList();
            setTimeout(initDragAndDrop, 100);
        };

        // Check if already logged in
        if (sessionStorage.getItem('tolkAdminLoggedIn') === 'true') {
            showAdminPanel();
        }
    </script>
</body>
</html>
